# Windows-specific linker configuration to avoid PDB errors
[target.x86_64-pc-windows-msvc]
# Disable incremental compilation and debug info to avoid LNK1318 PDB size limits
# Use /DEBUG:NONE to completely disable PDB generation
# /NODEFAULTLIB:libcmt to suppress LNK4098 warning
# /OPT:NOREF reduces object file size
# /EMITPOGOPHASEINFO disables PDB usage
rustflags = [
    "-C", "incremental=off",
    "-C", "debuginfo=0",
    "-C", "codegen-units=256",
    "-C", "link-arg=/DEBUG:NONE",
    "-C", "link-arg=/NODEFAULTLIB:libcmt",
    "-C", "link-arg=/INCREMENTAL:NO",
    "-C", "link-arg=/OPT:NOREF",
    "-C", "link-arg=/PDBALTPATH:none",
]

# Set environment variable to disable PDB generation on Windows
[env]
# Force disable PDB generation for all Windows MSVC builds
_NO_DEBUG_HEAP = "1"

# Reduce optimization for build scripts to avoid Windows PDB size limits (LNK1318)
# Build scripts that use large dependencies (like V8/deno_core) generate
# enormous object files when heavily optimized, exceeding Windows linker limits
[profile.release.build-override]
opt-level = 0
debug = 0
incremental = false
split-debuginfo = "off"
codegen-units = 256

[profile.dist.build-override]
opt-level = 0
debug = 0
incremental = false
split-debuginfo = "off"
codegen-units = 256

[alias]
pctx = "run -p pctx --"
